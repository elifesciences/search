# propagate SIGINT to waiting process
#trap 'kill -INT -$waitingPid' INT

interrupt_fn() {
  set +e
  echo "script is exiting. Performing cleanup..."

  echo "Cleaner PID = '$waitingPid'"
  ps -p "$waitingPid" > /dev/null
  if [ $? -eq 0 ]; then
    echo "Queue Cleaner is still running. Killing..."
    kill "$waitingPid"
    #wait "$waitingPid"
    echo "Queue Cleaner has terminated"
  fi

  echo "Worker PID = '$workerPid'"
  ps -p "$workerPid" > /dev/null
  if [ $? -eq 0 ]; then
    echo "Worker is still running. Killing..."
    kill "$workerPid"
    #wait "$workerPid"
    echo "Worker has terminated"
  fi

  echo "Watcher PID = '$queueWatchPid'"
  ps -p "$queueWatchPid" > /dev/null
  if [ $? -eq 0 ]; then
    echo "Watcher is still running. Killing..."
    kill "$queueWatchPid"
    #wait "$queueWatchPid"
    echo "Watcher has terminated"
  fi

  echo "Cleanup complete, exiting..."
}

trap interrupt_fn EXIT
