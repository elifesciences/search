# final verification
# we start from an empty index
total=$(curl -v localhost/search | jq ".total")
if [ ! "$total" ]; then
    total=-1
fi

echo "Total results in the index: $total"
expected_results_api_dummy=$(bin/console gateway:total)
if [ ! "$total" -eq "$expected_results_api_dummy" ]; then
    echo "There should be exactly $expected_results_api_dummy results in the index"
    if [ "$total" -gt "$expected_results_api_dummy" ]; then
        echo "(have more test fixtures been added to api-dummy?)"
    fi
    exit 2
fi
echo "Success!"
