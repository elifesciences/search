elifePipeline {
    def commit
    stage 'Checkout approved', {
        checkout scm
        commit = elifeGitRevision()
    }

    stage 'Deploy', {
        elifeDeploySlackNotification 'search', 'prod'
        elifeGitMoveToBranch commit, 'master'
        builderDeployRevision 'search--prod', commit
        builderSmokeTests 'search--prod', '/srv/search'
        builderCmd 'search--prod', "cd /srv/search; ./bin/reindex-on-demand prod elife_search_${env.BUILD_NUMBER}"
    }
}
